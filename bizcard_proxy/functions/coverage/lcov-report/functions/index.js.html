
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for functions/index.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../index.html">All files</a> / <a href="index.html">functions</a> index.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">35.43% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>163/460</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">28.95% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>97/335</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">50% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>13/26</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">36.19% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>152/420</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a>
<a name='L216'></a><a href='#L216'>216</a>
<a name='L217'></a><a href='#L217'>217</a>
<a name='L218'></a><a href='#L218'>218</a>
<a name='L219'></a><a href='#L219'>219</a>
<a name='L220'></a><a href='#L220'>220</a>
<a name='L221'></a><a href='#L221'>221</a>
<a name='L222'></a><a href='#L222'>222</a>
<a name='L223'></a><a href='#L223'>223</a>
<a name='L224'></a><a href='#L224'>224</a>
<a name='L225'></a><a href='#L225'>225</a>
<a name='L226'></a><a href='#L226'>226</a>
<a name='L227'></a><a href='#L227'>227</a>
<a name='L228'></a><a href='#L228'>228</a>
<a name='L229'></a><a href='#L229'>229</a>
<a name='L230'></a><a href='#L230'>230</a>
<a name='L231'></a><a href='#L231'>231</a>
<a name='L232'></a><a href='#L232'>232</a>
<a name='L233'></a><a href='#L233'>233</a>
<a name='L234'></a><a href='#L234'>234</a>
<a name='L235'></a><a href='#L235'>235</a>
<a name='L236'></a><a href='#L236'>236</a>
<a name='L237'></a><a href='#L237'>237</a>
<a name='L238'></a><a href='#L238'>238</a>
<a name='L239'></a><a href='#L239'>239</a>
<a name='L240'></a><a href='#L240'>240</a>
<a name='L241'></a><a href='#L241'>241</a>
<a name='L242'></a><a href='#L242'>242</a>
<a name='L243'></a><a href='#L243'>243</a>
<a name='L244'></a><a href='#L244'>244</a>
<a name='L245'></a><a href='#L245'>245</a>
<a name='L246'></a><a href='#L246'>246</a>
<a name='L247'></a><a href='#L247'>247</a>
<a name='L248'></a><a href='#L248'>248</a>
<a name='L249'></a><a href='#L249'>249</a>
<a name='L250'></a><a href='#L250'>250</a>
<a name='L251'></a><a href='#L251'>251</a>
<a name='L252'></a><a href='#L252'>252</a>
<a name='L253'></a><a href='#L253'>253</a>
<a name='L254'></a><a href='#L254'>254</a>
<a name='L255'></a><a href='#L255'>255</a>
<a name='L256'></a><a href='#L256'>256</a>
<a name='L257'></a><a href='#L257'>257</a>
<a name='L258'></a><a href='#L258'>258</a>
<a name='L259'></a><a href='#L259'>259</a>
<a name='L260'></a><a href='#L260'>260</a>
<a name='L261'></a><a href='#L261'>261</a>
<a name='L262'></a><a href='#L262'>262</a>
<a name='L263'></a><a href='#L263'>263</a>
<a name='L264'></a><a href='#L264'>264</a>
<a name='L265'></a><a href='#L265'>265</a>
<a name='L266'></a><a href='#L266'>266</a>
<a name='L267'></a><a href='#L267'>267</a>
<a name='L268'></a><a href='#L268'>268</a>
<a name='L269'></a><a href='#L269'>269</a>
<a name='L270'></a><a href='#L270'>270</a>
<a name='L271'></a><a href='#L271'>271</a>
<a name='L272'></a><a href='#L272'>272</a>
<a name='L273'></a><a href='#L273'>273</a>
<a name='L274'></a><a href='#L274'>274</a>
<a name='L275'></a><a href='#L275'>275</a>
<a name='L276'></a><a href='#L276'>276</a>
<a name='L277'></a><a href='#L277'>277</a>
<a name='L278'></a><a href='#L278'>278</a>
<a name='L279'></a><a href='#L279'>279</a>
<a name='L280'></a><a href='#L280'>280</a>
<a name='L281'></a><a href='#L281'>281</a>
<a name='L282'></a><a href='#L282'>282</a>
<a name='L283'></a><a href='#L283'>283</a>
<a name='L284'></a><a href='#L284'>284</a>
<a name='L285'></a><a href='#L285'>285</a>
<a name='L286'></a><a href='#L286'>286</a>
<a name='L287'></a><a href='#L287'>287</a>
<a name='L288'></a><a href='#L288'>288</a>
<a name='L289'></a><a href='#L289'>289</a>
<a name='L290'></a><a href='#L290'>290</a>
<a name='L291'></a><a href='#L291'>291</a>
<a name='L292'></a><a href='#L292'>292</a>
<a name='L293'></a><a href='#L293'>293</a>
<a name='L294'></a><a href='#L294'>294</a>
<a name='L295'></a><a href='#L295'>295</a>
<a name='L296'></a><a href='#L296'>296</a>
<a name='L297'></a><a href='#L297'>297</a>
<a name='L298'></a><a href='#L298'>298</a>
<a name='L299'></a><a href='#L299'>299</a>
<a name='L300'></a><a href='#L300'>300</a>
<a name='L301'></a><a href='#L301'>301</a>
<a name='L302'></a><a href='#L302'>302</a>
<a name='L303'></a><a href='#L303'>303</a>
<a name='L304'></a><a href='#L304'>304</a>
<a name='L305'></a><a href='#L305'>305</a>
<a name='L306'></a><a href='#L306'>306</a>
<a name='L307'></a><a href='#L307'>307</a>
<a name='L308'></a><a href='#L308'>308</a>
<a name='L309'></a><a href='#L309'>309</a>
<a name='L310'></a><a href='#L310'>310</a>
<a name='L311'></a><a href='#L311'>311</a>
<a name='L312'></a><a href='#L312'>312</a>
<a name='L313'></a><a href='#L313'>313</a>
<a name='L314'></a><a href='#L314'>314</a>
<a name='L315'></a><a href='#L315'>315</a>
<a name='L316'></a><a href='#L316'>316</a>
<a name='L317'></a><a href='#L317'>317</a>
<a name='L318'></a><a href='#L318'>318</a>
<a name='L319'></a><a href='#L319'>319</a>
<a name='L320'></a><a href='#L320'>320</a>
<a name='L321'></a><a href='#L321'>321</a>
<a name='L322'></a><a href='#L322'>322</a>
<a name='L323'></a><a href='#L323'>323</a>
<a name='L324'></a><a href='#L324'>324</a>
<a name='L325'></a><a href='#L325'>325</a>
<a name='L326'></a><a href='#L326'>326</a>
<a name='L327'></a><a href='#L327'>327</a>
<a name='L328'></a><a href='#L328'>328</a>
<a name='L329'></a><a href='#L329'>329</a>
<a name='L330'></a><a href='#L330'>330</a>
<a name='L331'></a><a href='#L331'>331</a>
<a name='L332'></a><a href='#L332'>332</a>
<a name='L333'></a><a href='#L333'>333</a>
<a name='L334'></a><a href='#L334'>334</a>
<a name='L335'></a><a href='#L335'>335</a>
<a name='L336'></a><a href='#L336'>336</a>
<a name='L337'></a><a href='#L337'>337</a>
<a name='L338'></a><a href='#L338'>338</a>
<a name='L339'></a><a href='#L339'>339</a>
<a name='L340'></a><a href='#L340'>340</a>
<a name='L341'></a><a href='#L341'>341</a>
<a name='L342'></a><a href='#L342'>342</a>
<a name='L343'></a><a href='#L343'>343</a>
<a name='L344'></a><a href='#L344'>344</a>
<a name='L345'></a><a href='#L345'>345</a>
<a name='L346'></a><a href='#L346'>346</a>
<a name='L347'></a><a href='#L347'>347</a>
<a name='L348'></a><a href='#L348'>348</a>
<a name='L349'></a><a href='#L349'>349</a>
<a name='L350'></a><a href='#L350'>350</a>
<a name='L351'></a><a href='#L351'>351</a>
<a name='L352'></a><a href='#L352'>352</a>
<a name='L353'></a><a href='#L353'>353</a>
<a name='L354'></a><a href='#L354'>354</a>
<a name='L355'></a><a href='#L355'>355</a>
<a name='L356'></a><a href='#L356'>356</a>
<a name='L357'></a><a href='#L357'>357</a>
<a name='L358'></a><a href='#L358'>358</a>
<a name='L359'></a><a href='#L359'>359</a>
<a name='L360'></a><a href='#L360'>360</a>
<a name='L361'></a><a href='#L361'>361</a>
<a name='L362'></a><a href='#L362'>362</a>
<a name='L363'></a><a href='#L363'>363</a>
<a name='L364'></a><a href='#L364'>364</a>
<a name='L365'></a><a href='#L365'>365</a>
<a name='L366'></a><a href='#L366'>366</a>
<a name='L367'></a><a href='#L367'>367</a>
<a name='L368'></a><a href='#L368'>368</a>
<a name='L369'></a><a href='#L369'>369</a>
<a name='L370'></a><a href='#L370'>370</a>
<a name='L371'></a><a href='#L371'>371</a>
<a name='L372'></a><a href='#L372'>372</a>
<a name='L373'></a><a href='#L373'>373</a>
<a name='L374'></a><a href='#L374'>374</a>
<a name='L375'></a><a href='#L375'>375</a>
<a name='L376'></a><a href='#L376'>376</a>
<a name='L377'></a><a href='#L377'>377</a>
<a name='L378'></a><a href='#L378'>378</a>
<a name='L379'></a><a href='#L379'>379</a>
<a name='L380'></a><a href='#L380'>380</a>
<a name='L381'></a><a href='#L381'>381</a>
<a name='L382'></a><a href='#L382'>382</a>
<a name='L383'></a><a href='#L383'>383</a>
<a name='L384'></a><a href='#L384'>384</a>
<a name='L385'></a><a href='#L385'>385</a>
<a name='L386'></a><a href='#L386'>386</a>
<a name='L387'></a><a href='#L387'>387</a>
<a name='L388'></a><a href='#L388'>388</a>
<a name='L389'></a><a href='#L389'>389</a>
<a name='L390'></a><a href='#L390'>390</a>
<a name='L391'></a><a href='#L391'>391</a>
<a name='L392'></a><a href='#L392'>392</a>
<a name='L393'></a><a href='#L393'>393</a>
<a name='L394'></a><a href='#L394'>394</a>
<a name='L395'></a><a href='#L395'>395</a>
<a name='L396'></a><a href='#L396'>396</a>
<a name='L397'></a><a href='#L397'>397</a>
<a name='L398'></a><a href='#L398'>398</a>
<a name='L399'></a><a href='#L399'>399</a>
<a name='L400'></a><a href='#L400'>400</a>
<a name='L401'></a><a href='#L401'>401</a>
<a name='L402'></a><a href='#L402'>402</a>
<a name='L403'></a><a href='#L403'>403</a>
<a name='L404'></a><a href='#L404'>404</a>
<a name='L405'></a><a href='#L405'>405</a>
<a name='L406'></a><a href='#L406'>406</a>
<a name='L407'></a><a href='#L407'>407</a>
<a name='L408'></a><a href='#L408'>408</a>
<a name='L409'></a><a href='#L409'>409</a>
<a name='L410'></a><a href='#L410'>410</a>
<a name='L411'></a><a href='#L411'>411</a>
<a name='L412'></a><a href='#L412'>412</a>
<a name='L413'></a><a href='#L413'>413</a>
<a name='L414'></a><a href='#L414'>414</a>
<a name='L415'></a><a href='#L415'>415</a>
<a name='L416'></a><a href='#L416'>416</a>
<a name='L417'></a><a href='#L417'>417</a>
<a name='L418'></a><a href='#L418'>418</a>
<a name='L419'></a><a href='#L419'>419</a>
<a name='L420'></a><a href='#L420'>420</a>
<a name='L421'></a><a href='#L421'>421</a>
<a name='L422'></a><a href='#L422'>422</a>
<a name='L423'></a><a href='#L423'>423</a>
<a name='L424'></a><a href='#L424'>424</a>
<a name='L425'></a><a href='#L425'>425</a>
<a name='L426'></a><a href='#L426'>426</a>
<a name='L427'></a><a href='#L427'>427</a>
<a name='L428'></a><a href='#L428'>428</a>
<a name='L429'></a><a href='#L429'>429</a>
<a name='L430'></a><a href='#L430'>430</a>
<a name='L431'></a><a href='#L431'>431</a>
<a name='L432'></a><a href='#L432'>432</a>
<a name='L433'></a><a href='#L433'>433</a>
<a name='L434'></a><a href='#L434'>434</a>
<a name='L435'></a><a href='#L435'>435</a>
<a name='L436'></a><a href='#L436'>436</a>
<a name='L437'></a><a href='#L437'>437</a>
<a name='L438'></a><a href='#L438'>438</a>
<a name='L439'></a><a href='#L439'>439</a>
<a name='L440'></a><a href='#L440'>440</a>
<a name='L441'></a><a href='#L441'>441</a>
<a name='L442'></a><a href='#L442'>442</a>
<a name='L443'></a><a href='#L443'>443</a>
<a name='L444'></a><a href='#L444'>444</a>
<a name='L445'></a><a href='#L445'>445</a>
<a name='L446'></a><a href='#L446'>446</a>
<a name='L447'></a><a href='#L447'>447</a>
<a name='L448'></a><a href='#L448'>448</a>
<a name='L449'></a><a href='#L449'>449</a>
<a name='L450'></a><a href='#L450'>450</a>
<a name='L451'></a><a href='#L451'>451</a>
<a name='L452'></a><a href='#L452'>452</a>
<a name='L453'></a><a href='#L453'>453</a>
<a name='L454'></a><a href='#L454'>454</a>
<a name='L455'></a><a href='#L455'>455</a>
<a name='L456'></a><a href='#L456'>456</a>
<a name='L457'></a><a href='#L457'>457</a>
<a name='L458'></a><a href='#L458'>458</a>
<a name='L459'></a><a href='#L459'>459</a>
<a name='L460'></a><a href='#L460'>460</a>
<a name='L461'></a><a href='#L461'>461</a>
<a name='L462'></a><a href='#L462'>462</a>
<a name='L463'></a><a href='#L463'>463</a>
<a name='L464'></a><a href='#L464'>464</a>
<a name='L465'></a><a href='#L465'>465</a>
<a name='L466'></a><a href='#L466'>466</a>
<a name='L467'></a><a href='#L467'>467</a>
<a name='L468'></a><a href='#L468'>468</a>
<a name='L469'></a><a href='#L469'>469</a>
<a name='L470'></a><a href='#L470'>470</a>
<a name='L471'></a><a href='#L471'>471</a>
<a name='L472'></a><a href='#L472'>472</a>
<a name='L473'></a><a href='#L473'>473</a>
<a name='L474'></a><a href='#L474'>474</a>
<a name='L475'></a><a href='#L475'>475</a>
<a name='L476'></a><a href='#L476'>476</a>
<a name='L477'></a><a href='#L477'>477</a>
<a name='L478'></a><a href='#L478'>478</a>
<a name='L479'></a><a href='#L479'>479</a>
<a name='L480'></a><a href='#L480'>480</a>
<a name='L481'></a><a href='#L481'>481</a>
<a name='L482'></a><a href='#L482'>482</a>
<a name='L483'></a><a href='#L483'>483</a>
<a name='L484'></a><a href='#L484'>484</a>
<a name='L485'></a><a href='#L485'>485</a>
<a name='L486'></a><a href='#L486'>486</a>
<a name='L487'></a><a href='#L487'>487</a>
<a name='L488'></a><a href='#L488'>488</a>
<a name='L489'></a><a href='#L489'>489</a>
<a name='L490'></a><a href='#L490'>490</a>
<a name='L491'></a><a href='#L491'>491</a>
<a name='L492'></a><a href='#L492'>492</a>
<a name='L493'></a><a href='#L493'>493</a>
<a name='L494'></a><a href='#L494'>494</a>
<a name='L495'></a><a href='#L495'>495</a>
<a name='L496'></a><a href='#L496'>496</a>
<a name='L497'></a><a href='#L497'>497</a>
<a name='L498'></a><a href='#L498'>498</a>
<a name='L499'></a><a href='#L499'>499</a>
<a name='L500'></a><a href='#L500'>500</a>
<a name='L501'></a><a href='#L501'>501</a>
<a name='L502'></a><a href='#L502'>502</a>
<a name='L503'></a><a href='#L503'>503</a>
<a name='L504'></a><a href='#L504'>504</a>
<a name='L505'></a><a href='#L505'>505</a>
<a name='L506'></a><a href='#L506'>506</a>
<a name='L507'></a><a href='#L507'>507</a>
<a name='L508'></a><a href='#L508'>508</a>
<a name='L509'></a><a href='#L509'>509</a>
<a name='L510'></a><a href='#L510'>510</a>
<a name='L511'></a><a href='#L511'>511</a>
<a name='L512'></a><a href='#L512'>512</a>
<a name='L513'></a><a href='#L513'>513</a>
<a name='L514'></a><a href='#L514'>514</a>
<a name='L515'></a><a href='#L515'>515</a>
<a name='L516'></a><a href='#L516'>516</a>
<a name='L517'></a><a href='#L517'>517</a>
<a name='L518'></a><a href='#L518'>518</a>
<a name='L519'></a><a href='#L519'>519</a>
<a name='L520'></a><a href='#L520'>520</a>
<a name='L521'></a><a href='#L521'>521</a>
<a name='L522'></a><a href='#L522'>522</a>
<a name='L523'></a><a href='#L523'>523</a>
<a name='L524'></a><a href='#L524'>524</a>
<a name='L525'></a><a href='#L525'>525</a>
<a name='L526'></a><a href='#L526'>526</a>
<a name='L527'></a><a href='#L527'>527</a>
<a name='L528'></a><a href='#L528'>528</a>
<a name='L529'></a><a href='#L529'>529</a>
<a name='L530'></a><a href='#L530'>530</a>
<a name='L531'></a><a href='#L531'>531</a>
<a name='L532'></a><a href='#L532'>532</a>
<a name='L533'></a><a href='#L533'>533</a>
<a name='L534'></a><a href='#L534'>534</a>
<a name='L535'></a><a href='#L535'>535</a>
<a name='L536'></a><a href='#L536'>536</a>
<a name='L537'></a><a href='#L537'>537</a>
<a name='L538'></a><a href='#L538'>538</a>
<a name='L539'></a><a href='#L539'>539</a>
<a name='L540'></a><a href='#L540'>540</a>
<a name='L541'></a><a href='#L541'>541</a>
<a name='L542'></a><a href='#L542'>542</a>
<a name='L543'></a><a href='#L543'>543</a>
<a name='L544'></a><a href='#L544'>544</a>
<a name='L545'></a><a href='#L545'>545</a>
<a name='L546'></a><a href='#L546'>546</a>
<a name='L547'></a><a href='#L547'>547</a>
<a name='L548'></a><a href='#L548'>548</a>
<a name='L549'></a><a href='#L549'>549</a>
<a name='L550'></a><a href='#L550'>550</a>
<a name='L551'></a><a href='#L551'>551</a>
<a name='L552'></a><a href='#L552'>552</a>
<a name='L553'></a><a href='#L553'>553</a>
<a name='L554'></a><a href='#L554'>554</a>
<a name='L555'></a><a href='#L555'>555</a>
<a name='L556'></a><a href='#L556'>556</a>
<a name='L557'></a><a href='#L557'>557</a>
<a name='L558'></a><a href='#L558'>558</a>
<a name='L559'></a><a href='#L559'>559</a>
<a name='L560'></a><a href='#L560'>560</a>
<a name='L561'></a><a href='#L561'>561</a>
<a name='L562'></a><a href='#L562'>562</a>
<a name='L563'></a><a href='#L563'>563</a>
<a name='L564'></a><a href='#L564'>564</a>
<a name='L565'></a><a href='#L565'>565</a>
<a name='L566'></a><a href='#L566'>566</a>
<a name='L567'></a><a href='#L567'>567</a>
<a name='L568'></a><a href='#L568'>568</a>
<a name='L569'></a><a href='#L569'>569</a>
<a name='L570'></a><a href='#L570'>570</a>
<a name='L571'></a><a href='#L571'>571</a>
<a name='L572'></a><a href='#L572'>572</a>
<a name='L573'></a><a href='#L573'>573</a>
<a name='L574'></a><a href='#L574'>574</a>
<a name='L575'></a><a href='#L575'>575</a>
<a name='L576'></a><a href='#L576'>576</a>
<a name='L577'></a><a href='#L577'>577</a>
<a name='L578'></a><a href='#L578'>578</a>
<a name='L579'></a><a href='#L579'>579</a>
<a name='L580'></a><a href='#L580'>580</a>
<a name='L581'></a><a href='#L581'>581</a>
<a name='L582'></a><a href='#L582'>582</a>
<a name='L583'></a><a href='#L583'>583</a>
<a name='L584'></a><a href='#L584'>584</a>
<a name='L585'></a><a href='#L585'>585</a>
<a name='L586'></a><a href='#L586'>586</a>
<a name='L587'></a><a href='#L587'>587</a>
<a name='L588'></a><a href='#L588'>588</a>
<a name='L589'></a><a href='#L589'>589</a>
<a name='L590'></a><a href='#L590'>590</a>
<a name='L591'></a><a href='#L591'>591</a>
<a name='L592'></a><a href='#L592'>592</a>
<a name='L593'></a><a href='#L593'>593</a>
<a name='L594'></a><a href='#L594'>594</a>
<a name='L595'></a><a href='#L595'>595</a>
<a name='L596'></a><a href='#L596'>596</a>
<a name='L597'></a><a href='#L597'>597</a>
<a name='L598'></a><a href='#L598'>598</a>
<a name='L599'></a><a href='#L599'>599</a>
<a name='L600'></a><a href='#L600'>600</a>
<a name='L601'></a><a href='#L601'>601</a>
<a name='L602'></a><a href='#L602'>602</a>
<a name='L603'></a><a href='#L603'>603</a>
<a name='L604'></a><a href='#L604'>604</a>
<a name='L605'></a><a href='#L605'>605</a>
<a name='L606'></a><a href='#L606'>606</a>
<a name='L607'></a><a href='#L607'>607</a>
<a name='L608'></a><a href='#L608'>608</a>
<a name='L609'></a><a href='#L609'>609</a>
<a name='L610'></a><a href='#L610'>610</a>
<a name='L611'></a><a href='#L611'>611</a>
<a name='L612'></a><a href='#L612'>612</a>
<a name='L613'></a><a href='#L613'>613</a>
<a name='L614'></a><a href='#L614'>614</a>
<a name='L615'></a><a href='#L615'>615</a>
<a name='L616'></a><a href='#L616'>616</a>
<a name='L617'></a><a href='#L617'>617</a>
<a name='L618'></a><a href='#L618'>618</a>
<a name='L619'></a><a href='#L619'>619</a>
<a name='L620'></a><a href='#L620'>620</a>
<a name='L621'></a><a href='#L621'>621</a>
<a name='L622'></a><a href='#L622'>622</a>
<a name='L623'></a><a href='#L623'>623</a>
<a name='L624'></a><a href='#L624'>624</a>
<a name='L625'></a><a href='#L625'>625</a>
<a name='L626'></a><a href='#L626'>626</a>
<a name='L627'></a><a href='#L627'>627</a>
<a name='L628'></a><a href='#L628'>628</a>
<a name='L629'></a><a href='#L629'>629</a>
<a name='L630'></a><a href='#L630'>630</a>
<a name='L631'></a><a href='#L631'>631</a>
<a name='L632'></a><a href='#L632'>632</a>
<a name='L633'></a><a href='#L633'>633</a>
<a name='L634'></a><a href='#L634'>634</a>
<a name='L635'></a><a href='#L635'>635</a>
<a name='L636'></a><a href='#L636'>636</a>
<a name='L637'></a><a href='#L637'>637</a>
<a name='L638'></a><a href='#L638'>638</a>
<a name='L639'></a><a href='#L639'>639</a>
<a name='L640'></a><a href='#L640'>640</a>
<a name='L641'></a><a href='#L641'>641</a>
<a name='L642'></a><a href='#L642'>642</a>
<a name='L643'></a><a href='#L643'>643</a>
<a name='L644'></a><a href='#L644'>644</a>
<a name='L645'></a><a href='#L645'>645</a>
<a name='L646'></a><a href='#L646'>646</a>
<a name='L647'></a><a href='#L647'>647</a>
<a name='L648'></a><a href='#L648'>648</a>
<a name='L649'></a><a href='#L649'>649</a>
<a name='L650'></a><a href='#L650'>650</a>
<a name='L651'></a><a href='#L651'>651</a>
<a name='L652'></a><a href='#L652'>652</a>
<a name='L653'></a><a href='#L653'>653</a>
<a name='L654'></a><a href='#L654'>654</a>
<a name='L655'></a><a href='#L655'>655</a>
<a name='L656'></a><a href='#L656'>656</a>
<a name='L657'></a><a href='#L657'>657</a>
<a name='L658'></a><a href='#L658'>658</a>
<a name='L659'></a><a href='#L659'>659</a>
<a name='L660'></a><a href='#L660'>660</a>
<a name='L661'></a><a href='#L661'>661</a>
<a name='L662'></a><a href='#L662'>662</a>
<a name='L663'></a><a href='#L663'>663</a>
<a name='L664'></a><a href='#L664'>664</a>
<a name='L665'></a><a href='#L665'>665</a>
<a name='L666'></a><a href='#L666'>666</a>
<a name='L667'></a><a href='#L667'>667</a>
<a name='L668'></a><a href='#L668'>668</a>
<a name='L669'></a><a href='#L669'>669</a>
<a name='L670'></a><a href='#L670'>670</a>
<a name='L671'></a><a href='#L671'>671</a>
<a name='L672'></a><a href='#L672'>672</a>
<a name='L673'></a><a href='#L673'>673</a>
<a name='L674'></a><a href='#L674'>674</a>
<a name='L675'></a><a href='#L675'>675</a>
<a name='L676'></a><a href='#L676'>676</a>
<a name='L677'></a><a href='#L677'>677</a>
<a name='L678'></a><a href='#L678'>678</a>
<a name='L679'></a><a href='#L679'>679</a>
<a name='L680'></a><a href='#L680'>680</a>
<a name='L681'></a><a href='#L681'>681</a>
<a name='L682'></a><a href='#L682'>682</a>
<a name='L683'></a><a href='#L683'>683</a>
<a name='L684'></a><a href='#L684'>684</a>
<a name='L685'></a><a href='#L685'>685</a>
<a name='L686'></a><a href='#L686'>686</a>
<a name='L687'></a><a href='#L687'>687</a>
<a name='L688'></a><a href='#L688'>688</a>
<a name='L689'></a><a href='#L689'>689</a>
<a name='L690'></a><a href='#L690'>690</a>
<a name='L691'></a><a href='#L691'>691</a>
<a name='L692'></a><a href='#L692'>692</a>
<a name='L693'></a><a href='#L693'>693</a>
<a name='L694'></a><a href='#L694'>694</a>
<a name='L695'></a><a href='#L695'>695</a>
<a name='L696'></a><a href='#L696'>696</a>
<a name='L697'></a><a href='#L697'>697</a>
<a name='L698'></a><a href='#L698'>698</a>
<a name='L699'></a><a href='#L699'>699</a>
<a name='L700'></a><a href='#L700'>700</a>
<a name='L701'></a><a href='#L701'>701</a>
<a name='L702'></a><a href='#L702'>702</a>
<a name='L703'></a><a href='#L703'>703</a>
<a name='L704'></a><a href='#L704'>704</a>
<a name='L705'></a><a href='#L705'>705</a>
<a name='L706'></a><a href='#L706'>706</a>
<a name='L707'></a><a href='#L707'>707</a>
<a name='L708'></a><a href='#L708'>708</a>
<a name='L709'></a><a href='#L709'>709</a>
<a name='L710'></a><a href='#L710'>710</a>
<a name='L711'></a><a href='#L711'>711</a>
<a name='L712'></a><a href='#L712'>712</a>
<a name='L713'></a><a href='#L713'>713</a>
<a name='L714'></a><a href='#L714'>714</a>
<a name='L715'></a><a href='#L715'>715</a>
<a name='L716'></a><a href='#L716'>716</a>
<a name='L717'></a><a href='#L717'>717</a>
<a name='L718'></a><a href='#L718'>718</a>
<a name='L719'></a><a href='#L719'>719</a>
<a name='L720'></a><a href='#L720'>720</a>
<a name='L721'></a><a href='#L721'>721</a>
<a name='L722'></a><a href='#L722'>722</a>
<a name='L723'></a><a href='#L723'>723</a>
<a name='L724'></a><a href='#L724'>724</a>
<a name='L725'></a><a href='#L725'>725</a>
<a name='L726'></a><a href='#L726'>726</a>
<a name='L727'></a><a href='#L727'>727</a>
<a name='L728'></a><a href='#L728'>728</a>
<a name='L729'></a><a href='#L729'>729</a>
<a name='L730'></a><a href='#L730'>730</a>
<a name='L731'></a><a href='#L731'>731</a>
<a name='L732'></a><a href='#L732'>732</a>
<a name='L733'></a><a href='#L733'>733</a>
<a name='L734'></a><a href='#L734'>734</a>
<a name='L735'></a><a href='#L735'>735</a>
<a name='L736'></a><a href='#L736'>736</a>
<a name='L737'></a><a href='#L737'>737</a>
<a name='L738'></a><a href='#L738'>738</a>
<a name='L739'></a><a href='#L739'>739</a>
<a name='L740'></a><a href='#L740'>740</a>
<a name='L741'></a><a href='#L741'>741</a>
<a name='L742'></a><a href='#L742'>742</a>
<a name='L743'></a><a href='#L743'>743</a>
<a name='L744'></a><a href='#L744'>744</a>
<a name='L745'></a><a href='#L745'>745</a>
<a name='L746'></a><a href='#L746'>746</a>
<a name='L747'></a><a href='#L747'>747</a>
<a name='L748'></a><a href='#L748'>748</a>
<a name='L749'></a><a href='#L749'>749</a>
<a name='L750'></a><a href='#L750'>750</a>
<a name='L751'></a><a href='#L751'>751</a>
<a name='L752'></a><a href='#L752'>752</a>
<a name='L753'></a><a href='#L753'>753</a>
<a name='L754'></a><a href='#L754'>754</a>
<a name='L755'></a><a href='#L755'>755</a>
<a name='L756'></a><a href='#L756'>756</a>
<a name='L757'></a><a href='#L757'>757</a>
<a name='L758'></a><a href='#L758'>758</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// Load environment variables from a local .env file if present (dev/local only)
try {
  // eslint-disable-next-line global-require
  require('dotenv').config();
} catch (e) {
  // dotenv is optional; ignore if not installed/available
}
&nbsp;
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const crypto = require('crypto');
&nbsp;
const app = express();
app.use(helmet());
&nbsp;
// CORS hardening: allow a configurable list of origins in production.
// Set PROXY_ALLOWED_ORIGINS to a comma-separated list of allowed origins (example: https://example.com,https://app.example.com)
const ALLOWED_ORIGINS = process.env.PROXY_ALLOWED_ORIGINS ? <span class="branch-0 cbranch-no" title="branch not covered" >process.env.PROXY_ALLOWED_ORIGINS.split(',').map(<span class="fstat-no" title="function not covered" >s </span>=&gt; <span class="cstat-no" title="statement not covered" >s.trim())</span>.filter(Boolean) </span>: null;
app.use(cors({
  origin: function(origin, callback) {
    // allow requests with no origin (mobile apps, curl)
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!origin) return callback(null, true);
<span class="cstat-no" title="statement not covered" >    if (!ALLOWED_ORIGINS) <span class="cstat-no" title="statement not covered" >return callback(null, true); </span></span>// permissive for dev when not configured
<span class="cstat-no" title="statement not covered" >    if (ALLOWED_ORIGINS.indexOf(origin) !== -1) <span class="cstat-no" title="statement not covered" >return callback(null, true);</span></span>
<span class="cstat-no" title="statement not covered" >    return callback(new Error('CORS not allowed for origin: ' + origin));</span>
  }
}));
&nbsp;
// Capture raw body for signature verification (verify option)
app.use(express.json({ limit: '128kb', verify: (req, res, buf) =&gt; { req.rawBody = buf &amp;&amp; buf.length ? buf.toString('utf8') : <span class="branch-1 cbranch-no" title="branch not covered" >'';</span> } }));
&nbsp;
// Initialize Sentry (optional)
let Sentry = null;
<span class="missing-if-branch" title="if path not taken" >I</span>if (process.env.SENTRY_DSN) {
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    Sentry = require('@sentry/node');</span>
<span class="cstat-no" title="statement not covered" >    Sentry.init({ dsn: process.env.SENTRY_DSN });</span>
<span class="cstat-no" title="statement not covered" >    console.log('Sentry initialized');</span>
    // Ensure request handler is registered before routes
<span class="cstat-no" title="statement not covered" >    app.use(Sentry.Handlers.requestHandler());</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    console.warn('Sentry init failed:', e.message || e);</span>
<span class="cstat-no" title="statement not covered" >    Sentry = null;</span>
  }
}
// Lightweight latency logging
app.use((req, res, next) =&gt; {
  const start = Date.now();
  res.on('finish', () =&gt; {
    try {
      console.log(`[${res.statusCode}] ${req.path} - ${Date.now() - start}ms`);
    } catch (_) { /* noop */ }
  });
  next();
});
&nbsp;
// Initialize Google Cloud Logging (optional)
let loggingClient = null;
try {
  const {Logging} = require('@google-cloud/logging');
<span class="cstat-no" title="statement not covered" >  loggingClient = new Logging();</span>
} catch (e) {
  loggingClient = null;
}
&nbsp;
function <span class="fstat-no" title="function not covered" >logEvent(</span>level, message, meta = <span class="branch-0 cbranch-no" title="branch not covered" >{})</span> {
  const logEntry = <span class="cstat-no" title="statement not covered" >Object.assign({ message }, meta);</span>
<span class="cstat-no" title="statement not covered" >  if (loggingClient) {</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
      const log = <span class="cstat-no" title="statement not covered" >loggingClient.log('bizcard-proxy');</span>
      const entry = <span class="cstat-no" title="statement not covered" >log.entry({ resource: { type: 'global' } }, logEntry);</span>
<span class="cstat-no" title="statement not covered" >      log.write(entry).catch(<span class="fstat-no" title="function not covered" >(e</span>rr) =&gt; <span class="cstat-no" title="statement not covered" >console.warn('Cloud Logging write failed', err))</span>;</span>
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      console.warn('Cloud Logging error', e.message || e);</span>
    }
  }
  // fallback to console
<span class="cstat-no" title="statement not covered" >  if (level === 'warn') <span class="cstat-no" title="statement not covered" >console.warn(message, meta);</span></span>
  else <span class="cstat-no" title="statement not covered" >if (level === 'error') <span class="cstat-no" title="statement not covered" >console.error(message, meta);</span></span>
  else <span class="cstat-no" title="statement not covered" >console.log(message, meta);</span>
}
&nbsp;
// Optional Firebase Admin (for token verification) and Redis (for production rate limiting)
let admin = null;
try {
  admin = require('firebase-admin');
  // Initialize if not already initialized and if credentials are available via env
  <span class="missing-if-branch" title="else path not taken" >E</span>if (!admin.apps || admin.apps.length === 0) {
    try {
      // 1) If service account JSON is provided via env var, use it (helpful for local testing)
      <span class="missing-if-branch" title="if path not taken" >I</span>if (process.env.FIREBASE_SERVICE_ACCOUNT_JSON) {
<span class="cstat-no" title="statement not covered" >        try {</span>
          const sa = <span class="cstat-no" title="statement not covered" >JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT_JSON);</span>
<span class="cstat-no" title="statement not covered" >          admin.initializeApp({ credential: admin.credential.cert(sa) });</span>
<span class="cstat-no" title="statement not covered" >          console.log('firebase-admin initialized from FIREBASE_SERVICE_ACCOUNT_JSON');</span>
        } catch (e) {
<span class="cstat-no" title="statement not covered" >          console.warn('Failed to parse FIREBASE_SERVICE_ACCOUNT_JSON, falling back to default init', e.message || e);</span>
<span class="cstat-no" title="statement not covered" >          admin.initializeApp();</span>
        }
      } else <span class="missing-if-branch" title="if path not taken" >I</span>if (process.env.GOOGLE_APPLICATION_CREDENTIALS) {
        // 2) If GOOGLE_APPLICATION_CREDENTIALS is set (file path), default init will read it
<span class="cstat-no" title="statement not covered" >        admin.initializeApp();</span>
<span class="cstat-no" title="statement not covered" >        console.log('firebase-admin initialized using GOOGLE_APPLICATION_CREDENTIALS');</span>
      } else {
        // 3) Otherwise, try default initialization (works on GCP/Firebase runtimes)
        admin.initializeApp();
        console.log('firebase-admin initialized with default credentials (GCP environment)');
      }
    } catch (e) {
      // ignore init errors when running locally without proper service account; token verify will fail if required
<span class="cstat-no" title="statement not covered" >      console.warn('firebase-admin initialization warning:', e.message || e);</span>
    }
  }
} catch (e) {
  // firebase-admin not installed or not available
<span class="cstat-no" title="statement not covered" >  admin = null;</span>
}
&nbsp;
let Redis = null;
let redisClient = null;
const REDIS_URL = process.env.REDIS_URL || null;
<span class="missing-if-branch" title="if path not taken" >I</span>if (REDIS_URL) {
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    Redis = require('ioredis');</span>
<span class="cstat-no" title="statement not covered" >    redisClient = new Redis(REDIS_URL);</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    console.warn('ioredis not available or failed to connect:', e.message || e);</span>
<span class="cstat-no" title="statement not covered" >    redisClient = null;</span>
  }
}
// Expose redis client on the app instance for routes/healthchecks
app.set('redis', redisClient);
&nbsp;
// Google Secret Manager support (optional)
let secretManagerClient = null;
let cachedGeminiKey = null;
const SECRET_MANAGER_NAME = process.env.GEMINI_SECRET_NAME || null; // e.g. projects/PROJECT_ID/secrets/NAME/versions/latest
try {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (SECRET_MANAGER_NAME) {
    const {SecretManagerServiceClient} = <span class="cstat-no" title="statement not covered" >require('@google-cloud/secret-manager');</span>
<span class="cstat-no" title="statement not covered" >    secretManagerClient = new SecretManagerServiceClient();</span>
  }
} catch (e) {
<span class="cstat-no" title="statement not covered" >  secretManagerClient = null;</span>
}
&nbsp;
async function getGeminiKey() {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (cachedGeminiKey) <span class="cstat-no" title="statement not covered" >return cachedGeminiKey;</span>
  // 1) Prefer Secret Manager
  <span class="missing-if-branch" title="if path not taken" >I</span>if (secretManagerClient &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >SECRET_MANAGER_NAME)</span> {
<span class="cstat-no" title="statement not covered" >    try {</span>
      const [accessResponse] = <span class="cstat-no" title="statement not covered" >await secretManagerClient.accessSecretVersion({ name: SECRET_MANAGER_NAME });</span>
      const payload = <span class="cstat-no" title="statement not covered" >accessResponse.payload &amp;&amp; accessResponse.payload.data ? accessResponse.payload.data.toString('utf8') : null;</span>
<span class="cstat-no" title="statement not covered" >      if (payload) {</span>
<span class="cstat-no" title="statement not covered" >        cachedGeminiKey = payload.trim();</span>
<span class="cstat-no" title="statement not covered" >        return cachedGeminiKey;</span>
      }
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      console.warn('Secret Manager fetch failed, falling back to env var:', e.message || e);</span>
    }
  }
&nbsp;
  // 2) Fallback to environment variable
  const envKey = process.env.GEMINI_API_KEY || null;
  <span class="missing-if-branch" title="if path not taken" >I</span>if (envKey) {
<span class="cstat-no" title="statement not covered" >    cachedGeminiKey = envKey;</span>
<span class="cstat-no" title="statement not covered" >    return cachedGeminiKey;</span>
  }
  return null;
}
&nbsp;
// Retry/backoff helper for transient errors when calling external APIs
const RETRY_MAX_ATTEMPTS = process.env.RETRY_MAX_ATTEMPTS ? <span class="branch-0 cbranch-no" title="branch not covered" >parseInt(process.env.RETRY_MAX_ATTEMPTS, 10) </span>: 4;
const RETRY_INITIAL_MS = process.env.RETRY_INITIAL_MS ? <span class="branch-0 cbranch-no" title="branch not covered" >parseInt(process.env.RETRY_INITIAL_MS, 10) </span>: 500; // 0.5s
const RETRY_MAX_MS = process.env.RETRY_MAX_MS ? <span class="branch-0 cbranch-no" title="branch not covered" >parseInt(process.env.RETRY_MAX_MS, 10) </span>: 8000; // 8s
&nbsp;
function <span class="fstat-no" title="function not covered" >sleep(</span>ms) {
<span class="cstat-no" title="statement not covered" >  return new Promise(<span class="fstat-no" title="function not covered" >(r</span>esolve) =&gt; <span class="cstat-no" title="statement not covered" >setTimeout(resolve, ms))</span>;</span>
}
&nbsp;
async function <span class="fstat-no" title="function not covered" >fetchWithRetry(</span>url, options = <span class="branch-0 cbranch-no" title="branch not covered" >{},</span> maxAttempts = <span class="branch-0 cbranch-no" title="branch not covered" >RETRY_MAX_ATTEMPTS)</span> {
  let attempt = <span class="cstat-no" title="statement not covered" >0;</span>
  let delay = <span class="cstat-no" title="statement not covered" >RETRY_INITIAL_MS;</span>
<span class="cstat-no" title="statement not covered" >  while (attempt &lt; maxAttempts) {</span>
<span class="cstat-no" title="statement not covered" >    attempt += 1;</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
      const resp = <span class="cstat-no" title="statement not covered" >await fetch(url, options);</span>
      // Retry on 5xx or 429
<span class="cstat-no" title="statement not covered" >      if (resp.status &gt;= 500 || resp.status === 429) {</span>
        const text = <span class="cstat-no" title="statement not covered" >await resp.text().catch(<span class="fstat-no" title="function not covered" >()</span> =&gt; <span class="cstat-no" title="statement not covered" >'')</span>;</span>
<span class="cstat-no" title="statement not covered" >        logEvent('warn', 'fetch_retry_status', { url, status: resp.status, attempt, text: text.substring(0, 200) });</span>
<span class="cstat-no" title="statement not covered" >        if (attempt &gt;= maxAttempts) <span class="cstat-no" title="statement not covered" >return resp; </span></span>// return last response
        // exponential backoff + jitter
        const jitter = <span class="cstat-no" title="statement not covered" >Math.floor(Math.random() * 200);</span>
        const wait = <span class="cstat-no" title="statement not covered" >Math.min(delay + jitter, RETRY_MAX_MS);</span>
<span class="cstat-no" title="statement not covered" >        await sleep(wait);</span>
<span class="cstat-no" title="statement not covered" >        delay = Math.min(delay * 2, RETRY_MAX_MS);</span>
<span class="cstat-no" title="statement not covered" >        continue;</span>
      }
<span class="cstat-no" title="statement not covered" >      return resp;</span>
    } catch (err) {
      // network error - retry
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'fetch_retry_error', { url, error: err.message || err, attempt });</span>
<span class="cstat-no" title="statement not covered" >      if (Sentry) <span class="cstat-no" title="statement not covered" >Sentry.captureException(err);</span></span>
<span class="cstat-no" title="statement not covered" >      if (attempt &gt;= maxAttempts) <span class="cstat-no" title="statement not covered" >throw err;</span></span>
      const jitter = <span class="cstat-no" title="statement not covered" >Math.floor(Math.random() * 200);</span>
      const wait = <span class="cstat-no" title="statement not covered" >Math.min(delay + jitter, RETRY_MAX_MS);</span>
<span class="cstat-no" title="statement not covered" >      await sleep(wait);</span>
<span class="cstat-no" title="statement not covered" >      delay = Math.min(delay * 2, RETRY_MAX_MS);</span>
    }
  }
}
&nbsp;
// Unified parser utilities
const {
  sanitizeRawText,
  validateRequest,
  estimateTokensFromText,
  extractJsonFromText,
} = require('./utils/parser');
&nbsp;
// Simple in-memory rate limiter per session_id (fallback when Redis not configured)
const limits = new Map();
const WINDOW_MS = 60 * 1000; // 1 minute
const MAX_PER_WINDOW = 30; // max 30 requests per minute per session
&nbsp;
// Quota controls (tokens + requests)
const QUOTA_MAX_TOKENS = process.env.QUOTA_MAX_TOKENS ? <span class="branch-0 cbranch-no" title="branch not covered" >parseInt(process.env.QUOTA_MAX_TOKENS, 10) </span>: 100000; // tokens per period
const QUOTA_PERIOD_MS = process.env.QUOTA_PERIOD_MS ? parseInt(process.env.QUOTA_PERIOD_MS, 10) : 30 * 24 * 60 * 60 * 1000; // 30 days
const QUOTA_MAX_REQUESTS = process.env.QUOTA_MAX_REQUESTS ? parseInt(process.env.QUOTA_MAX_REQUESTS, 10) : 1000; // requests per period
&nbsp;
// In-memory fallback for quotas (not persistent)
const quotaMemory = new Map();
&nbsp;
async function checkAndReserveQuota(sessionId, reserveTokens = <span class="branch-0 cbranch-no" title="branch not covered" >0,</span> reserveRequests = <span class="branch-0 cbranch-no" title="branch not covered" >1)</span> {
  // If Redis available, use it
  <span class="missing-if-branch" title="if path not taken" >I</span>if (redisClient) {
<span class="cstat-no" title="statement not covered" >    try {</span>
      const tokensKey = <span class="cstat-no" title="statement not covered" >`quota:tokens:${sessionId}`;</span>
      const reqKey = <span class="cstat-no" title="statement not covered" >`quota:req:${sessionId}`;</span>
      // Reserve tokens
      const newTokens = <span class="cstat-no" title="statement not covered" >await redisClient.incrby(tokensKey, reserveTokens);</span>
<span class="cstat-no" title="statement not covered" >      if (newTokens === reserveTokens) {</span>
        // first time, set expiry
<span class="cstat-no" title="statement not covered" >        await redisClient.pexpire(tokensKey, QUOTA_PERIOD_MS);</span>
      }
<span class="cstat-no" title="statement not covered" >      if (newTokens &gt; QUOTA_MAX_TOKENS) {</span>
        // revert
<span class="cstat-no" title="statement not covered" >        await redisClient.decrby(tokensKey, reserveTokens);</span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
      }
      // Reserve requests
      const newReqs = <span class="cstat-no" title="statement not covered" >await redisClient.incrby(reqKey, reserveRequests);</span>
<span class="cstat-no" title="statement not covered" >      if (newReqs === reserveRequests) {</span>
<span class="cstat-no" title="statement not covered" >        await redisClient.pexpire(reqKey, QUOTA_PERIOD_MS);</span>
      }
<span class="cstat-no" title="statement not covered" >      if (newReqs &gt; QUOTA_MAX_REQUESTS) {</span>
        // revert both
<span class="cstat-no" title="statement not covered" >        await redisClient.decrby(tokensKey, reserveTokens);</span>
<span class="cstat-no" title="statement not covered" >        await redisClient.decrby(reqKey, reserveRequests);</span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
      }
<span class="cstat-no" title="statement not covered" >      return true;</span>
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'quota_redis_error', { error: e.message || e });</span>
    }
  }
&nbsp;
  // Fallback to in-memory simple quota
  const now = Date.now();
  const entry = quotaMemory.get(sessionId) || { tokens: 0, reqs: 0, ts: now };
  <span class="missing-if-branch" title="if path not taken" >I</span>if (now - entry.ts &gt; QUOTA_PERIOD_MS) {
<span class="cstat-no" title="statement not covered" >    entry.tokens = 0;</span>
<span class="cstat-no" title="statement not covered" >    entry.reqs = 0;</span>
<span class="cstat-no" title="statement not covered" >    entry.ts = now;</span>
  }
  <span class="missing-if-branch" title="if path not taken" >I</span>if (entry.tokens + reserveTokens &gt; QUOTA_MAX_TOKENS) <span class="cstat-no" title="statement not covered" >return false;</span>
  <span class="missing-if-branch" title="if path not taken" >I</span>if (entry.reqs + reserveRequests &gt; QUOTA_MAX_REQUESTS) <span class="cstat-no" title="statement not covered" >return false;</span>
  entry.tokens += reserveTokens;
  entry.reqs += reserveRequests;
  quotaMemory.set(sessionId, entry);
  return true;
}
&nbsp;
async function <span class="fstat-no" title="function not covered" >adjustQuotaAfterCall(</span>sessionId, additionalTokens = <span class="branch-0 cbranch-no" title="branch not covered" >0)</span> {
<span class="cstat-no" title="statement not covered" >  if (!additionalTokens) <span class="cstat-no" title="statement not covered" >return;</span></span>
<span class="cstat-no" title="statement not covered" >  if (redisClient) {</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
      const tokensKey = <span class="cstat-no" title="statement not covered" >`quota:tokens:${sessionId}`;</span>
      const newTokens = <span class="cstat-no" title="statement not covered" >await redisClient.incrby(tokensKey, additionalTokens);</span>
      // ensure expiry present
<span class="cstat-no" title="statement not covered" >      await redisClient.pexpire(tokensKey, QUOTA_PERIOD_MS);</span>
<span class="cstat-no" title="statement not covered" >      return newTokens;</span>
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'quota_adjust_redis_error', { error: e.message || e });</span>
    }
  }
  const entry = <span class="cstat-no" title="statement not covered" >quotaMemory.get(sessionId) || { tokens: 0, reqs: 0, ts: Date.now() };</span>
<span class="cstat-no" title="statement not covered" >  entry.tokens += additionalTokens;</span>
<span class="cstat-no" title="statement not covered" >  quotaMemory.set(sessionId, entry);</span>
<span class="cstat-no" title="statement not covered" >  return entry.tokens;</span>
}
&nbsp;
async function <span class="fstat-no" title="function not covered" >getQuotaStatus(</span>sessionId) {
<span class="cstat-no" title="statement not covered" >  if (redisClient) {</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
      const tokensKey = <span class="cstat-no" title="statement not covered" >`quota:tokens:${sessionId}`;</span>
      const reqKey = <span class="cstat-no" title="statement not covered" >`quota:req:${sessionId}`;</span>
      const [tokens, reqs] = <span class="cstat-no" title="statement not covered" >await Promise.all([redisClient.get(tokensKey), redisClient.get(reqKey)]);</span>
<span class="cstat-no" title="statement not covered" >      return {</span>
        tokens: parseInt(tokens || '0', 10),
        requests: parseInt(reqs || '0', 10),
        maxTokens: QUOTA_MAX_TOKENS,
        maxRequests: QUOTA_MAX_REQUESTS,
        periodMs: QUOTA_PERIOD_MS,
      };
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'quota_status_redis_error', { error: e.message || e });</span>
    }
  }
  const entry = <span class="cstat-no" title="statement not covered" >quotaMemory.get(sessionId) || { tokens: 0, reqs: 0, ts: Date.now() };</span>
<span class="cstat-no" title="statement not covered" >  return {</span>
    tokens: entry.tokens,
    requests: entry.reqs,
    maxTokens: QUOTA_MAX_TOKENS,
    maxRequests: QUOTA_MAX_REQUESTS,
    periodMs: QUOTA_PERIOD_MS,
  };
}
&nbsp;
async function checkRateLimit(sessionId) {
  // If Redis is configured, use a simple INCR+EXPIRE approach
  <span class="missing-if-branch" title="if path not taken" >I</span>if (redisClient) {
    const banKey = <span class="cstat-no" title="statement not covered" >`ban:${sessionId}`;</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
      // Check ban first
      const isBanned = <span class="cstat-no" title="statement not covered" >await redisClient.get(banKey);</span>
<span class="cstat-no" title="statement not covered" >      if (isBanned) {</span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
      }
&nbsp;
      // Sliding window using sorted set
      const key = <span class="cstat-no" title="statement not covered" >`rl:${sessionId}`;</span>
      const now = <span class="cstat-no" title="statement not covered" >Date.now();</span>
      const windowMs = <span class="cstat-no" title="statement not covered" >process.env.RATE_LIMIT_WINDOW_MS ? parseInt(process.env.RATE_LIMIT_WINDOW_MS, 10) : WINDOW_MS;</span>
      const maxPerWindow = <span class="cstat-no" title="statement not covered" >process.env.RATE_LIMIT_MAX ? parseInt(process.env.RATE_LIMIT_MAX, 10) : MAX_PER_WINDOW;</span>
&nbsp;
      // Add current event with score == timestamp
      // member needs to be unique; use timestamp+random
      const member = <span class="cstat-no" title="statement not covered" >`${now}-${Math.random()}`;</span>
<span class="cstat-no" title="statement not covered" >      await redisClient.zadd(key, now, member);</span>
&nbsp;
      // Remove old entries outside the window
<span class="cstat-no" title="statement not covered" >      await redisClient.zremrangebyscore(key, 0, now - windowMs);</span>
&nbsp;
      // Count current items
      const count = <span class="cstat-no" title="statement not covered" >await redisClient.zcard(key);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (count &gt; maxPerWindow) {</span>
        // Violation: increment violation counter and impose an escalating ban
        const vioKey = <span class="cstat-no" title="statement not covered" >`vio:${sessionId}`;</span>
        const vio = <span class="cstat-no" title="statement not covered" >await redisClient.incr(vioKey);</span>
        // Keep vio counter for a reasonable period (10x window)
<span class="cstat-no" title="statement not covered" >        await redisClient.pexpire(vioKey, windowMs * 10);</span>
&nbsp;
        const baseBanMs = <span class="cstat-no" title="statement not covered" >process.env.BAN_BASE_MS ? parseInt(process.env.BAN_BASE_MS, 10) : 5 * 60 * 1000;</span> // 5 minutes
        const banMaxMs = <span class="cstat-no" title="statement not covered" >process.env.BAN_MAX_MS ? parseInt(process.env.BAN_MAX_MS, 10) : 24 * 60 * 60 * 1000;</span> // 24 hours
        // Exponential backoff: base * 2^(vio-1), capped to banMaxMs
        const banMs = <span class="cstat-no" title="statement not covered" >Math.min(baseBanMs * Math.pow(2, Math.max(0, vio - 1)), banMaxMs);</span>
<span class="cstat-no" title="statement not covered" >        await redisClient.set(banKey, '1', 'PX', banMs);</span>
&nbsp;
  // Log the ban event
<span class="cstat-no" title="statement not covered" >  logEvent('warn', 'rate_limit_ban', { sessionId, banMs, vio });</span>
<span class="cstat-no" title="statement not covered" >  if (Sentry) <span class="cstat-no" title="statement not covered" >Sentry.captureMessage(`Rate limit ban for ${sessionId}`, 'warning');</span></span>
<span class="cstat-no" title="statement not covered" >        return false;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      return true;</span>
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'redis_rate_limit_error', { error: e.message || e });</span>
<span class="cstat-no" title="statement not covered" >      console.warn('Redis rate limit failed, falling back to memory limiter', e.message || e);</span>
    }
  }
&nbsp;
  // Fallback to in-memory
  const now = Date.now();
  // Respect environment overrides for window and max even in memory mode
  const windowMs = process.env.RATE_LIMIT_WINDOW_MS ? parseInt(process.env.RATE_LIMIT_WINDOW_MS, 10) : WINDOW_MS;
  const maxPerWindow = process.env.RATE_LIMIT_MAX ? parseInt(process.env.RATE_LIMIT_MAX, 10) : MAX_PER_WINDOW;
  const entry = limits.get(sessionId) || { ts: now, count: 0 };
  <span class="missing-if-branch" title="if path not taken" >I</span>if (now - entry.ts &gt; windowMs) {
<span class="cstat-no" title="statement not covered" >    entry.ts = now;</span>
<span class="cstat-no" title="statement not covered" >    entry.count = 1;</span>
  } else {
    entry.count += 1;
  }
  limits.set(sessionId, entry);
  return entry.count &lt;= maxPerWindow;
}
&nbsp;
// extractJsonFromText provided by utils/parser
&nbsp;
// Simple local token verification middleware (no Firebase login).
// If REQUIRE_AUTH=true and signature middleware is not enforced, verify Authorization: Bearer &lt;token&gt;
// using either a static APP_SECRET or an HMAC signature comparison (APP_SIGNATURE).
app.use((req, res, next) =&gt; {
  try {
    const requireAuth = process.env.REQUIRE_AUTH === 'true';
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!requireAuth) return next();
&nbsp;
    // If signature requirement is active, defer to signature middleware for enforcement.
<span class="cstat-no" title="statement not covered" >    if (PROXY_REQUIRE_SIGNATURE &amp;&amp; PROXY_SIGNATURE_SECRET) <span class="cstat-no" title="statement not covered" >return next();</span></span>
&nbsp;
    // Prefer X-App-Token/X-App-Signature if present
    const xToken = <span class="cstat-no" title="statement not covered" >req.headers['x-app-token'];</span>
    const xSig = <span class="cstat-no" title="statement not covered" >req.headers['x-app-signature'];</span>
&nbsp;
    let token = <span class="cstat-no" title="statement not covered" >null;</span>
<span class="cstat-no" title="statement not covered" >    if (typeof xToken === 'string' &amp;&amp; xToken.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      token = xToken;</span>
    } else {
      const header = <span class="cstat-no" title="statement not covered" >req.headers.authorization || req.headers.Authorization;</span>
<span class="cstat-no" title="statement not covered" >      if (!header || typeof header !== 'string' || !header.startsWith('Bearer ')) {</span>
<span class="cstat-no" title="statement not covered" >        return res.status(401).json({ ok: false, error: 'missing_auth' });</span>
      }
<span class="cstat-no" title="statement not covered" >      token = header.split(' ')[1];</span>
    }
&nbsp;
    const APP_SECRET = <span class="cstat-no" title="statement not covered" >process.env.APP_SECRET || '';</span>
    const APP_SIGNATURE = <span class="cstat-no" title="statement not covered" >process.env.APP_SIGNATURE || '';</span>
&nbsp;
    // Option 1: Static shared secret
<span class="cstat-no" title="statement not covered" >    if (APP_SECRET &amp;&amp; token === APP_SECRET) <span class="cstat-no" title="statement not covered" >return next();</span></span>
&nbsp;
    // Option 2a: Dynamic HMAC(token) header verification (X-App-Signature)
<span class="cstat-no" title="statement not covered" >    if (APP_SECRET &amp;&amp; xSig &amp;&amp; typeof xSig === 'string') {</span>
      const h = <span class="cstat-no" title="statement not covered" >crypto.createHmac('sha256', APP_SECRET).update(token).digest('hex');</span>
      // timing-safe compare
<span class="cstat-no" title="statement not covered" >      try {</span>
        const a = <span class="cstat-no" title="statement not covered" >Buffer.from(h, 'utf8');</span>
        const b = <span class="cstat-no" title="statement not covered" >Buffer.from(xSig, 'utf8');</span>
<span class="cstat-no" title="statement not covered" >        if (a.length === b.length &amp;&amp; crypto.timingSafeEqual(a, b)) <span class="cstat-no" title="statement not covered" >return next();</span></span>
      } catch (_) { /* no-op */ }
    }
&nbsp;
    // Option 2b: Precomputed signature env compare (legacy)
<span class="cstat-no" title="statement not covered" >    if (APP_SECRET &amp;&amp; APP_SIGNATURE) {</span>
<span class="cstat-no" title="statement not covered" >      try {</span>
        const h = <span class="cstat-no" title="statement not covered" >crypto.createHmac('sha256', APP_SECRET).update(token).digest('hex');</span>
<span class="cstat-no" title="statement not covered" >        if (h === APP_SIGNATURE) <span class="cstat-no" title="statement not covered" >return next();</span></span>
      } catch (_) {}
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return res.status(401).json({ ok: false, error: 'invalid_token' });</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    logEvent('error', 'local_auth_middleware_error', { error: e.message || e });</span>
<span class="cstat-no" title="statement not covered" >    return res.status(500).json({ ok: false, error: 'internal_error' });</span>
  }
});
&nbsp;
// Optional HMAC signature middleware for anti-replay and CSRF-like protection.
// Set PROXY_REQUIRE_SIGNATURE=true and provide one or more secrets to enable.
// The client should send header PROXY_SIGNATURE_HEADER (default 'x-proxy-signature') with value: &lt;timestamp&gt;:&lt;hex_hmac&gt;
const PROXY_SIGNATURE_SECRET = process.env.PROXY_SIGNATURE_SECRET || null;
const PROXY_SIGNATURE_SECRET_PREV = process.env.PROXY_SIGNATURE_SECRET_PREV || null;
const PROXY_SIGNATURE_SECRETS = (process.env.PROXY_SIGNATURE_SECRETS || '')
  .split(',')
  .map(s =&gt; s.trim())
  .filter(Boolean);
// Consolidate candidate secrets: CSV list takes precedence; else use current + prev if provided
const SIG_SECRETS = PROXY_SIGNATURE_SECRETS.length &gt; 0
  ? <span class="branch-0 cbranch-no" title="branch not covered" >PROXY_SIGNATURE_SECRETS</span>
  : [PROXY_SIGNATURE_SECRET, PROXY_SIGNATURE_SECRET_PREV].filter(Boolean);
// If explicitly set to 'false', do not require signature. Otherwise, require if any secret configured or env says true.
const PROXY_REQUIRE_SIGNATURE = process.env.PROXY_REQUIRE_SIGNATURE === 'false' ? <span class="branch-0 cbranch-no" title="branch not covered" >false </span>: (process.env.PROXY_REQUIRE_SIGNATURE === 'true' || SIG_SECRETS.length &gt; 0);
const PROXY_SIGNATURE_HEADER = process.env.PROXY_SIGNATURE_HEADER || 'x-proxy-signature';
const PROXY_SIGNATURE_TTL_MS = process.env.PROXY_SIGNATURE_TTL_MS ? <span class="branch-0 cbranch-no" title="branch not covered" >parseInt(process.env.PROXY_SIGNATURE_TTL_MS, 10) </span>: 2 * 60 * 1000; // 2 minutes
&nbsp;
const replayCache = new Set(); // simple in-memory replay cache fallback
&nbsp;
&nbsp;
async function isReplay(key) {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (redisClient) {
<span class="cstat-no" title="statement not covered" >    try {</span>
      const exists = <span class="cstat-no" title="statement not covered" >await redisClient.get(key);</span>
<span class="cstat-no" title="statement not covered" >      if (exists) <span class="cstat-no" title="statement not covered" >return true;</span></span>
<span class="cstat-no" title="statement not covered" >      await redisClient.set(key, '1', 'PX', PROXY_SIGNATURE_TTL_MS);</span>
<span class="cstat-no" title="statement not covered" >      return false;</span>
    } catch (e) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'replay_redis_error', { error: e.message || e });</span>
    }
  }
  if (replayCache.has(key)) return true;
  replayCache.add(key);
  // schedule eviction
  const t = setTimeout(<span class="fstat-no" title="function not covered" >()</span> =&gt; <span class="cstat-no" title="statement not covered" >replayCache.delete(key),</span> Math.max(1000, PROXY_SIGNATURE_TTL_MS));
  <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof t.unref === 'function') t.unref();
  return false;
}
&nbsp;
app.use(async (req, res, next) =&gt; {
  try {
    if (!PROXY_REQUIRE_SIGNATURE) return next();
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!SIG_SECRETS || SIG_SECRETS.length === 0) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'signature_config_missing');</span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'server_misconfigured', message: 'signature secrets required' });</span>
    }
    const header = req.headers[PROXY_SIGNATURE_HEADER];
    if (!header || typeof header !== 'string') return res.status(401).json({ ok: false, error: 'missing_signature' });
    const parts = header.split(':');
    <span class="missing-if-branch" title="if path not taken" >I</span>if (parts.length !== 2) <span class="cstat-no" title="statement not covered" >return res.status(401).json({ ok: false, error: 'invalid_signature_format' });</span>
    const ts = parseInt(parts[0], 10);
    const sig = parts[1];
    <span class="missing-if-branch" title="if path not taken" >I</span>if (Number.isNaN(ts)) <span class="cstat-no" title="statement not covered" >return res.status(401).json({ ok: false, error: 'invalid_signature_timestamp' });</span>
    const now = Date.now();
    if (Math.abs(now - ts) &gt; PROXY_SIGNATURE_TTL_MS) return res.status(401).json({ ok: false, error: 'signature_expired' });
&nbsp;
    const payload = `${ts}:${req.rawBody || <span class="branch-1 cbranch-no" title="branch not covered" >''}</span>`;
    // Try all candidate secrets for rotation window support
    let matchedHmac = null;
    for (const secret of SIG_SECRETS) {
      try {
        const h = crypto.createHmac('sha256', secret).update(payload).digest('hex');
        <span class="missing-if-branch" title="else path not taken" >E</span>if (crypto.timingSafeEqual(Buffer.from(h), Buffer.from(sig))) {
          matchedHmac = h;
          break;
        }
      } catch (_) { /* ignore */ }
    }
    if (!matchedHmac) return res.status(401).json({ ok: false, error: 'invalid_signature' });
&nbsp;
    // prevent replay attacks using the matched signature as key
    const replayKey = `sig:${matchedHmac}`;
    if (await isReplay(replayKey)) return res.status(401).json({ ok: false, error: 'replay' });
&nbsp;
    return next();
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    logEvent('error', 'signature_middleware_error', { error: e.message || e });</span>
<span class="cstat-no" title="statement not covered" >    return res.status(500).json({ ok: false, error: 'internal_error' });</span>
  }
});
// Redis healthcheck endpoint
app.get('/health/redis', async (req, res) =&gt; {
  const rc = req.app.get('redis');
  <span class="missing-if-branch" title="else path not taken" >E</span>if (!rc) return res.status(503).json({ ok: false, connected: false, error: 'redis_unconfigured' });
<span class="cstat-no" title="statement not covered" >  try {</span>
    const pong = <span class="cstat-no" title="statement not covered" >await rc.ping();</span>
<span class="cstat-no" title="statement not covered" >    return res.json({ ok: true, connected: true, ping: pong });</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    return res.status(500).json({ ok: false, connected: false, error: e.message || String(e) });</span>
  }
});
&nbsp;
app.post('/format-card', async (req, res) =&gt; {
  try {
    const body = req.body || <span class="branch-1 cbranch-no" title="branch not covered" >{};</span>
    const validationError = validateRequest(body);
    <span class="missing-if-branch" title="if path not taken" >I</span>if (validationError) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'validation_error', { error: validationError, ip: req.ip });</span>
<span class="cstat-no" title="statement not covered" >      return res.status(400).json({ ok: false, error: validationError });</span>
    }
&nbsp;
    // Sanitized values
    const raw_text = sanitizeRawText(body.raw_text);
    const template = Array.isArray(body.template) ? <span class="branch-0 cbranch-no" title="branch not covered" >body.template </span>: undefined;
    const session_id = typeof body.session_id === 'string' ? body.session_id : undefined;
    const sessionId = session_id || (req.user &amp;&amp; <span class="branch-2 cbranch-no" title="branch not covered" >req.user.uid)</span> || req.ip || <span class="branch-4 cbranch-no" title="branch not covered" >'anonymous';</span>
&nbsp;
    const allowed = await checkRateLimit(sessionId);
    if (!allowed) {
      return res.status(429).json({ ok: false, error: 'rate_limited' });
    }
&nbsp;
    // Quota reservation: estimate tokens and reserve
    const estimatedTokens = estimateTokensFromText(raw_text);
    const quotaOk = await checkAndReserveQuota(sessionId, estimatedTokens, 1);
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!quotaOk) {
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'quota_exceeded', { sessionId });</span>
<span class="cstat-no" title="statement not covered" >      return res.status(402).json({ ok: false, error: 'quota_exceeded' });</span>
    }
&nbsp;
    const key = await getGeminiKey();
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!key) {
      console.error('Missing GEMINI API key (Secret Manager or GEMINI_API_KEY env).');
      return res.status(500).json({ ok: false, error: 'server_misconfigured' });
    }
&nbsp;
    // Build prompt
    const headers = <span class="cstat-no" title="statement not covered" >Array.isArray(template) ? template : [];</span>
    const headerList = <span class="cstat-no" title="statement not covered" >headers.length ? headers.join(', ') : 'Name, Company, Email, Phone, Website, Address';</span>
&nbsp;
    const prompt = <span class="cstat-no" title="statement not covered" >`You are an AI that converts unstructured text from a business card into structured JSON. Use these column names exactly as the JSON keys: ${headerList}. If a value is missing, return it as an empty string "". Return only valid JSON — no explanations or markdown. Raw text: ${raw_text}`;</span>
&nbsp;
    const aiRequestBody = <span class="cstat-no" title="statement not covered" >{</span>
      contents: [
        { parts: [{ text: prompt }] }
      ]
    };
&nbsp;
    const endpoint = <span class="cstat-no" title="statement not covered" >`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;</span>
&nbsp;
    const resp = <span class="cstat-no" title="statement not covered" >await fetchWithRetry(endpoint, {</span>
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(aiRequestBody),
    }, RETRY_MAX_ATTEMPTS);
&nbsp;
    const json = <span class="cstat-no" title="statement not covered" >await resp.json();</span>
    const text = <span class="cstat-no" title="statement not covered" >json?.candidates?.[0]?.content?.parts?.[0]?.text;</span>
    const data = <span class="cstat-no" title="statement not covered" >extractJsonFromText(text);</span>
<span class="cstat-no" title="statement not covered" >    if (!data) {</span>
      // rollback or adjust quota to reflect failure
<span class="cstat-no" title="statement not covered" >      await adjustQuotaAfterCall(sessionId, 0); </span>// no-op placeholder (could refund tokens if desired)
<span class="cstat-no" title="statement not covered" >      logEvent('error', 'parse_error', { sessionId, response: json });</span>
<span class="cstat-no" title="statement not covered" >      if (Sentry) <span class="cstat-no" title="statement not covered" >Sentry.captureException(new Error('Failed to parse JSON from AI output'));</span></span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'parse_error', message: 'Failed to parse JSON from AI output' });</span>
    }
&nbsp;
    // Success: quota already reserved; optionally adjust with actual tokens used
    const actualTokens = <span class="cstat-no" title="statement not covered" >estimateTokensFromText(text || JSON.stringify(data));</span>
<span class="cstat-no" title="statement not covered" >    await adjustQuotaAfterCall(sessionId, actualTokens - estimatedTokens);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    logEvent('info', 'format_card_success', { sessionId, tokens: actualTokens });</span>
<span class="cstat-no" title="statement not covered" >    return res.json({ ok: true, data, source: 'ai' });</span>
  } catch (err) {
<span class="cstat-no" title="statement not covered" >      logEvent('error', 'format_card_exception', { error: err.message || err });</span>
<span class="cstat-no" title="statement not covered" >      if (Sentry) <span class="cstat-no" title="statement not covered" >Sentry.captureException(err);</span></span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'internal_error', message: err.message });</span>
  }
});
&nbsp;
// Combined OCR processing pipeline: refine -&gt; structure -&gt; finalize
app.post('/process-ocr', <span class="fstat-no" title="function not covered" >as</span>ync (req, res) =&gt; {
<span class="cstat-no" title="statement not covered" >  try {</span>
    const body = <span class="cstat-no" title="statement not covered" >req.body || {};</span>
    const validationError = <span class="cstat-no" title="statement not covered" >validateRequest({ raw_text: body.raw_text });</span>
<span class="cstat-no" title="statement not covered" >    if (validationError) {</span>
<span class="cstat-no" title="statement not covered" >      logEvent('warn', 'validation_error', { error: validationError, ip: req.ip });</span>
<span class="cstat-no" title="statement not covered" >      return res.status(400).json({ ok: false, error: validationError });</span>
    }
&nbsp;
    const raw_text = <span class="cstat-no" title="statement not covered" >sanitizeRawText(body.raw_text);</span>
    const session_id = <span class="cstat-no" title="statement not covered" >typeof body.session_id === 'string' ? body.session_id : undefined;</span>
    const sessionId = <span class="cstat-no" title="statement not covered" >session_id || (req.user &amp;&amp; req.user.uid) || req.ip || 'anonymous';</span>
&nbsp;
    const allowed = <span class="cstat-no" title="statement not covered" >await checkRateLimit(sessionId);</span>
<span class="cstat-no" title="statement not covered" >    if (!allowed) <span class="cstat-no" title="statement not covered" >return res.status(429).json({ ok: false, error: 'rate_limited' });</span></span>
&nbsp;
    const key = <span class="cstat-no" title="statement not covered" >await getGeminiKey();</span>
<span class="cstat-no" title="statement not covered" >    if (!key) {</span>
<span class="cstat-no" title="statement not covered" >      console.error('Missing GEMINI API key (Secret Manager or GEMINI_API_KEY env).');</span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'server_misconfigured' });</span>
    }
&nbsp;
    // Reserve quota approximately for three prompts
    const estTokens = <span class="cstat-no" title="statement not covered" >estimateTokensFromText(raw_text) * 3;</span>
    const quotaOk = <span class="cstat-no" title="statement not covered" >await checkAndReserveQuota(sessionId, estTokens, 1);</span>
<span class="cstat-no" title="statement not covered" >    if (!quotaOk) <span class="cstat-no" title="statement not covered" >return res.status(402).json({ ok: false, error: 'quota_exceeded' });</span></span>
&nbsp;
    const baseEndpoint = <span class="cstat-no" title="statement not covered" >`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`;</span>
&nbsp;
    // 1) Refinement prompt
    const refinePrompt = <span class="cstat-no" title="statement not covered" >`You are an OCR text refinement AI. Clean and normalize the following text extracted from an image. Remove noise, fix spacing and formatting issues, and output only the corrected readable text — no extra explanation.\n\nText:\n${raw_text}`;</span>
    const refineReq = <span class="cstat-no" title="statement not covered" >{ contents: [{ parts: [{ text: refinePrompt }] }] };</span>
    const refineResp = <span class="cstat-no" title="statement not covered" >await fetchWithRetry(baseEndpoint, {</span>
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(refineReq),
    });
    const refineJson = <span class="cstat-no" title="statement not covered" >await refineResp.json();</span>
    const cleaned_text = <span class="cstat-no" title="statement not covered" >refineJson?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || '';</span>
<span class="cstat-no" title="statement not covered" >    if (!cleaned_text) {</span>
<span class="cstat-no" title="statement not covered" >      logEvent('error', 'refine_empty', { sessionId });</span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'refine_failed' });</span>
    }
&nbsp;
    // 2) Structuring prompt -&gt; expect JSON
    const structurePrompt = <span class="cstat-no" title="statement not covered" >`You are a data structuring AI. Analyze the following extracted text and convert it into well-structured JSON. Include only meaningful fields like name, address, ID number, date, card number, etc., based on what appears. Do not invent data. Return valid JSON only — no comments or explanations.\n\nText:\n${cleaned_text}`;</span>
    const structureReq = <span class="cstat-no" title="statement not covered" >{ contents: [{ parts: [{ text: structurePrompt }] }] };</span>
    const structureResp = <span class="cstat-no" title="statement not covered" >await fetchWithRetry(baseEndpoint, {</span>
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(structureReq),
    });
    const structureJson = <span class="cstat-no" title="statement not covered" >await structureResp.json();</span>
    const structuredText = <span class="cstat-no" title="statement not covered" >structureJson?.candidates?.[0]?.content?.parts?.[0]?.text || '';</span>
    let structured = <span class="cstat-no" title="statement not covered" >extractJsonFromText(structuredText);</span>
<span class="cstat-no" title="statement not covered" >    if (!structured) {</span>
<span class="cstat-no" title="statement not covered" >      logEvent('error', 'structure_parse_error', { sessionId, structuredText: structuredText?.slice(0, 200) });</span>
<span class="cstat-no" title="statement not covered" >      return res.status(500).json({ ok: false, error: 'structure_failed' });</span>
    }
&nbsp;
    // 3) Finalize/validation prompt
    const finalizePrompt = <span class="cstat-no" title="statement not covered" >`You are a validation and cleanup AI. Review this JSON data for consistency and accuracy. Fix obvious OCR misreads (like wrong date formats or misplaced values), ensure all keys follow lower_snake_case, and reformat it neatly as valid JSON.\n\nJSON Input:\n${JSON.stringify(structured)}`;</span>
    const finalizeReq = <span class="cstat-no" title="statement not covered" >{ contents: [{ parts: [{ text: finalizePrompt }] }] };</span>
    const finalizeResp = <span class="cstat-no" title="statement not covered" >await fetchWithRetry(baseEndpoint, {</span>
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(finalizeReq),
    });
    const finalizeJson = <span class="cstat-no" title="statement not covered" >await finalizeResp.json();</span>
    const finalText = <span class="cstat-no" title="statement not covered" >finalizeJson?.candidates?.[0]?.content?.parts?.[0]?.text || '';</span>
    let finalData = <span class="cstat-no" title="statement not covered" >extractJsonFromText(finalText);</span>
<span class="cstat-no" title="statement not covered" >    if (!finalData) {</span>
      // As a fallback, return the structured JSON if finalization parsing fails
<span class="cstat-no" title="statement not covered" >      finalData = structured;</span>
    }
&nbsp;
    // Adjust quota based on approximate actual tokens (combine all texts)
    const actualTokens = <span class="cstat-no" title="statement not covered" >estimateTokensFromText([cleaned_text, structuredText, finalText].join(' '));</span>
<span class="cstat-no" title="statement not covered" >    await adjustQuotaAfterCall(sessionId, actualTokens - estTokens);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return res.json({ ok: true, cleaned_text, structured_json: structured, final_json: finalData });</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    logEvent('error', 'process_ocr_exception', { error: e.message || e });</span>
<span class="cstat-no" title="statement not covered" >    return res.status(500).json({ ok: false, error: 'internal_error', message: e.message });</span>
  }
});
&nbsp;
// Quota status endpoint
app.get('/quota-status/:sessionId', <span class="fstat-no" title="function not covered" >as</span>ync (req, res) =&gt; {
<span class="cstat-no" title="statement not covered" >  try {</span>
    const sid = <span class="cstat-no" title="statement not covered" >req.params.sessionId || req.query.session_id || req.ip;</span>
    const status = <span class="cstat-no" title="statement not covered" >await getQuotaStatus(sid);</span>
<span class="cstat-no" title="statement not covered" >    return res.json({ ok: true, status });</span>
  } catch (e) {
<span class="cstat-no" title="statement not covered" >    return res.status(500).json({ ok: false, error: 'internal_error' });</span>
  }
});
&nbsp;
// attach Sentry error handler after routes
<span class="missing-if-branch" title="if path not taken" >I</span>if (Sentry) {
<span class="cstat-no" title="statement not covered" >  app.use(Sentry.Handlers.errorHandler());</span>
}
&nbsp;
// Export for Firebase Functions or run standalone
<span class="missing-if-branch" title="if path not taken" >I</span>if (require.main === module) {
<span class="cstat-no" title="statement not covered" >  if (process.env.NODE_ENV === 'production' &amp;&amp; process.env.PROXY_SIGNATURE_SECRET === 'test_secret') {</span>
<span class="cstat-no" title="statement not covered" >    console.warn('⚠️ Using default signature secret in production!');</span>
  }
  const port = <span class="cstat-no" title="statement not covered" >process.env.PORT || 3000;</span>
<span class="cstat-no" title="statement not covered" >  app.listen(port, <span class="fstat-no" title="function not covered" >()</span> =&gt; <span class="cstat-no" title="statement not covered" >console.log(`bizcard-proxy listening on ${port}`))</span>;</span>
}
&nbsp;
// Export for Firebase Functions if the package is available
try {
  // eslint-disable-next-line global-require
  const functions = require('firebase-functions');
  exports.api = functions.https.onRequest(app);
} catch (e) {
  // Not running in Firebase Functions environment - expose app for standalone run
<span class="cstat-no" title="statement not covered" >  module.exports = app;</span>
}
&nbsp;
// Always export app for tests and tooling
module.exports.app = app;
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-10-25T10:40:26.449Z
            </div>
        <script src="../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../sorter.js"></script>
        <script src="../block-navigation.js"></script>
    </body>
</html>
    